<div class="modal-content">
  <div class="modal-header" style="border: none;">
    <div class="d-flex justify-content-between align-items-center w-100">
      <h5 class="modal-title text-center mx-auto">{{ title }}</h5>
      <button type="button" class="btn btn-close-modal" (click)="close()">X</button>
    </div>
  </div>
  <div class="modal-body">
    <form [formGroup]="form" class="row g-3 d-flex justify-content-center" (submit)="save()">

      <input type="text" hidden id="id" formControlName="id">

      <div class="row">
        <div class="col-md-6 col-sm-12 col-xs-12">
          <div class="form-group row mb-2">
            <label for="origin_network_id" class="col-sm-6 label">Origin Network</label>
            <div class="col-sm-6">
              <select class="form-select" id="origin_network_id" formControlName="origin_network_id" (change)="onOriginNetworkChange()">
                @for (item of networksList; track $index) {
                <option value="{{ item.network_id }}">{{  item.network_id + ' | ' +item.name }}</option>
                }
              </select>
              <span class="text-danger mt-2" *ngIf="validInput('origin_network_id')">
                the field is required
              </span>
            </div>
          </div>
        </div>
        <div class="col-md-6 col-sm-12 col-xs-12">
        </div>
      </div>

      <div class="accordion" id="accordionExample">
        <div class="accordion-item">
          <h2 class="accordion-header" id="headingOne">
            <button class="accordion-button custom-accordion-header collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-controls="collapseOne"
              [attr.aria-expanded]="accordionA ? 'true' : 'false'" >
              Filters
            </button>
          </h2>
          <div id="collapseOne" class="accordion-collapse collapse" aria-labelledby="collapseOne" [ngClass]="{ 'show': accordionA }">
            <div class="accordion-body">
              <div class="row mt-2">
                <div class="col-sm-8">
                  <div class="row">
                    <div class="col-sm-6">
                      <div class="form-group row mb-2">
                        <label for="regex_source_addr" class="col-sm-6 label">Regex Source Address</label>
                        <div class="col-sm-6">
                          <input type="text" class="form-control" id="regex_source_addr" formControlName="regex_source_addr"
                            [class.is-invalid]="validInput('regex_source_addr')">
                          <span class="text-danger mt-2" *ngIf="validInput('regex_source_addr')">
                            the field is required
                          </span>
                        </div>
                      </div>
                
                      <div class="form-group row mb-2">
                        <label for="regex_source_addr_ton" class="col-sm-6 label">Regex Source Address TON</label>
                        <div class="col-sm-6">
                          <input type="text" class="form-control" id="regex_source_addr_ton" formControlName="regex_source_addr_ton"
                            [class.is-invalid]="validInput('regex_source_addr_ton')">
                          <span class="text-danger mt-2" *ngIf="validInput('regex_source_addr_ton')">
                            the field is required
                          </span>
                          <span class="text-danger mt-2" *ngIf="validPattern('regex_source_addr_ton')">
                            {{ getPatternMessage('regex_source_addr_ton') }}
                          </span>
                        </div>
                      </div>
                
                      <div class="form-group row mb-2">
                        <label for="regex_source_addr_npi" class="col-sm-6 label">Regex Source Address NPI</label>
                        <div class="col-sm-6">
                          <input type="text" class="form-control" id="regex_source_addr_npi" formControlName="regex_source_addr_npi"
                            [class.is-invalid]="validInput('regex_source_addr_npi')">
                          <span class="text-danger mt-2" *ngIf="validInput('regex_source_addr_npi')">
                            the field is required
                          </span>
                        </div>
                      </div>
                    </div>
    
                    <div class="col-sm-6">
                      <div class="form-group row mb-2">
                        <label for="regex_destination_addr" class="col-sm-6 label">Regex Destination Address</label>
                        <div class="col-sm-6">
                          <input type="text" class="form-control" id="regex_destination_addr" formControlName="regex_destination_addr"
                            [class.is-invalid]="validInput('regex_destination_addr')">
                          <span class="text-danger mt-2" *ngIf="validInput('regex_destination_addr')">
                            the field is required
                          </span>
                        </div>
                      </div>
                
                      <div class="form-group row mb-2">
                        <label for="regex_dest_addr_ton" class="col-sm-6 label">Regex Destination Address TON</label>
                        <div class="col-sm-6">
                          <input type="text" class="form-control" id="regex_dest_addr_ton" formControlName="regex_dest_addr_ton"
                            [class.is-invalid]="validInput('regex_dest_addr_ton')">
                          <span class="text-danger mt-2" *ngIf="validInput('regex_dest_addr_ton')">
                            the field is required
                          </span>
                          <span class="text-danger mt-2" *ngIf="validPattern('regex_dest_addr_ton')">
                            {{ getPatternMessage('regex_dest_addr_ton') }}
                          </span>
                        </div>
                      </div>
                
                      <div class="form-group row mb-2">
                        <label for="regex_dest_addr_npi" class="col-sm-6 label">Regex Destination Address NPI</label>
                        <div class="col-sm-6">
                          <input type="text" class="form-control" id="regex_dest_addr_npi" formControlName="regex_dest_addr_npi"
                            [class.is-invalid]="validInput('regex_dest_addr_npi')">
                          <span class="text-danger mt-2" *ngIf="validInput('regex_dest_addr_npi')">
                            the field is required
                          </span>
                          <span class="text-danger mt-2" *ngIf="validPattern('regex_dest_addr_npi')">
                            {{ getPatternMessage('regex_dest_addr_npi') }}
                          </span>
                        </div>
                      </div>
                    </div>
                  </div>

                  <div class="form-group row mb-2">
                    <label for="regex_short_message" class="col-sm-3 label">Regex Short Message</label>
                    <div class="col-sm-9">
                      <input type="text" class="form-control" id="regex_short_message" formControlName="regex_short_message"
                        [class.is-invalid]="validInput('regex_short_message')">
                      <span class="text-danger mt-2" *ngIf="validInput('regex_short_message')">
                        the field is required
                      </span>
                      <span class="text-danger mt-2" *ngIf="validPattern('regex_short_message')">
                        Regex is invalid
                      </span>
                    </div>
                  </div>
                </div>

                <div class="col-sm-4">
                  <div class="form-group row mb-2">
                    <label for="regex_imsi_digits_mask" class="col-sm-6 label">Regex IMSI Digits Mask</label>
                    <div class="col-sm-6">
                      <input type="text" class="form-control" id="regex_imsi_digits_mask" formControlName="regex_imsi_digits_mask"
                        [class.is-invalid]="validInput('regex_imsi_digits_mask')">
                      <span class="text-danger mt-2" *ngIf="validInput('regex_imsi_digits_mask')">
                        the field is required
                      </span>
                    </div>
                  </div>

                  <div class="form-group row mb-2">
                    <label for="regex_network_node_number" class="col-sm-6 label">Regex Network Node Number</label>
                    <div class="col-sm-6">
                      <input type="text" class="form-control" id="regex_network_node_number" formControlName="regex_network_node_number"
                        [class.is-invalid]="validInput('regex_network_node_number')">
                      <span class="text-danger mt-2" *ngIf="validInput('regex_network_node_number')">
                        the field is required
                      </span>
                      <span class="text-danger mt-2" *ngIf="validPattern('regex_network_node_number')">
                        {{ getPatternMessage('regex_network_node_number') }}
                      </span>
                    </div>
                  </div>
            
                  <div class="form-group row mb-2">
                    <label for="regex_calling_party_address" class="col-sm-6 label">Regex Calling Party Address</label>
                    <div class="col-sm-6">
                      <input type="text" class="form-control" id="regex_calling_party_address" formControlName="regex_calling_party_address"
                        [class.is-invalid]="validInput('regex_calling_party_address')">
                      <span class="text-danger mt-2" *ngIf="validInput('regex_calling_party_address')">
                        the field is required
                      </span>
                      <span class="text-danger mt-2" *ngIf="validPattern('regex_calling_party_address')">
                        {{ getPatternMessage('regex_calling_party_address') }}
                      </span>
                    </div>
                  </div>

                  <div class="form-group row mb-2">
                    <label for="is_sri_response" class="col-sm-6 label">is SRI Response </label>
                    <div class="col-sm-6">
                      <input type="checkbox" class="form-check-input check_form" id="is_sri_response" formControlName="is_sri_response"
                        [class.is-invalid]="validInput('is_sri_response')" (change)="onChangeSRI()">
                      <span class="text-danger mt-2" *ngIf="validInput('is_sri_response')">
                        the field is required
                      </span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      
        <div class="accordion-item">
          <h2 class="accordion-header" id="headingTwo">
            <button class="accordion-button custom-accordion-header collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTwo" aria-controls="collapseTwo"
              [attr.aria-expanded]="accordionB ? 'true' : 'false'" >
              Actions
            </button>
          </h2>
          <div id="collapseTwo" class="accordion-collapse collapse" aria-labelledby="headingTwo" [ngClass]="{ 'show': accordionB }">
            <div class="accordion-body">

              <div class="row mt-2">
                <div class="col-sm-8">
                  <div class="row">
                    <div class="col-sm-6">
                      <div class="form-group row mb-2">
                        <label for="new_source_addr" class="col-sm-6 label">New Source Address</label>
                        <div class="col-sm-6">
                          <input type="text" class="form-control" id="new_source_addr" formControlName="new_source_addr"
                            [class.is-invalid]="validInput('new_source_addr')">
                          <span class="text-danger mt-2" *ngIf="validInput('new_source_addr')">
                            the field is required
                          </span>
                        </div>
                      </div>
    
                      <div class="form-group row mb-2">
                        <label for="remove_source_addr_prefix" class="col-sm-6 label">Remove Source Address Prefix</label>
                        <div class="col-sm-6">
                          <input type="text" class="form-control" id="remove_source_addr_prefix" formControlName="remove_source_addr_prefix"
                            [class.is-invalid]="validInput('remove_source_addr_prefix')">
                          <span class="text-danger mt-2" *ngIf="validInput('remove_source_addr_prefix')">
                            the field is required
                          </span>
                          <span class="text-danger mt-2" *ngIf="validPattern('remove_source_addr_prefix')">
                            {{ getPatternMessage('remove_source_addr_prefix') }}
                          </span>
                        </div>
                      </div>
    
                      <div class="form-group row mb-2">
                        <label for="add_source_addr_prefix" class="col-sm-6 label">Add Source Address Prefix</label>
                        <div class="col-sm-6">
                          <input type="text" class="form-control" id="add_source_addr_prefix" formControlName="add_source_addr_prefix"
                            [class.is-invalid]="validInput('add_source_addr_prefix')">
                          <span class="text-danger mt-2" *ngIf="validInput('add_source_addr_prefix')">
                            the field is required
                          </span>
                          <span class="text-danger mt-2" *ngIf="validPattern('add_source_addr_prefix')">
                            {{ getPatternMessage('add_source_addr_prefix') }}
                          </span>
                        </div>
                      </div>
                
                      <div class="form-group row mb-2">
                        <label for="new_source_addr_ton" class="col-sm-6 label">New Source Address TON</label>
                        <div class="col-sm-6">
                          <select class="form-select" id="new_source_addr_ton" formControlName="new_source_addr_ton">
                            @for (item of newSourceAddressTonList; track $index) {
                            <option value="{{ item.id }}">{{ item.description }}</option>
                            }
                          </select>
                          <span class="text-danger mt-2" *ngIf="validInput('new_source_addr_ton')">
                            the field is required
                          </span>
                        </div>
                      </div>
                
                      <div class="form-group row mb-2">
                        <label for="new_source_addr_npi" class="col-sm-6 label">New Source Address NPI</label>
                        <div class="col-sm-6">
                          <select class="form-select" id="new_source_addr_npi" formControlName="new_source_addr_npi">
                            @for (item of newSourceAddressNpiList; track $index) {
                            <option value="{{ item.id }}">{{ item.description }}</option>
                            }
                          </select>
                          <span class="text-danger mt-2" *ngIf="validInput('new_source_addr_npi')">
                            the field is required
                          </span>
                        </div>
                      </div>
                    </div>

                    <div class="col-sm-6">
                      <div class="form-group row mb-2">
                        <label for="new_destination_addr" class="col-sm-6 label">New Destination Address</label>
                        <div class="col-sm-6">
                          <input type="text" class="form-control" id="new_destination_addr" formControlName="new_destination_addr"
                            [class.is-invalid]="validInput('new_destination_addr')">
                          <span class="text-danger mt-2" *ngIf="validInput('new_destination_addr')">
                            the field is required
                          </span>
                        </div>
                      </div>
    
                      <div class="form-group row mb-2">
                        <label for="remove_dest_addr_prefix" class="col-sm-6 label">Remove Destination Address Prefix</label>
                        <div class="col-sm-6">
                          <input type="text" class="form-control" id="remove_dest_addr_prefix" formControlName="remove_dest_addr_prefix"
                            [class.is-invalid]="validInput('remove_dest_addr_prefix')">
                          <span class="text-danger mt-2" *ngIf="validInput('remove_dest_addr_prefix')">
                            the field is required
                          </span>
                          <span class="text-danger mt-2" *ngIf="validPattern('remove_dest_addr_prefix')">
                            {{ getPatternMessage('remove_dest_addr_prefix') }}
                          </span>
                        </div>
                      </div>
    
                      <div class="form-group row mb-2">
                        <label for="add_dest_addr_prefix" class="col-sm-6 label">Add Destination Address Prefix</label>
                        <div class="col-sm-6">
                          <input type="text" class="form-control" id="add_dest_addr_prefix" formControlName="add_dest_addr_prefix"
                            [class.is-invalid]="validInput('add_dest_addr_prefix')">
                          <span class="text-danger mt-2" *ngIf="validInput('add_dest_addr_prefix')">
                            the field is required
                          </span>
                          <span class="text-danger mt-2" *ngIf="validPattern('add_dest_addr_prefix')">
                            {{ getPatternMessage('add_dest_addr_prefix') }}
                          </span>
                        </div>
                      </div>
                
                      <div class="form-group row mb-2">
                        <label for="new_dest_addr_ton" class="col-sm-6 label">New Destination Address TON</label>
                        <div class="col-sm-6">
                          <select class="form-select" id="new_dest_addr_ton" formControlName="new_dest_addr_ton">
                            @for (item of newDestAddrTonList; track $index) {
                            <option value="{{ item.id }}">{{ item.description }}</option>
                            }
                          </select>
                          <span class="text-danger mt-2" *ngIf="validInput('new_dest_addr_ton')">
                            the field is required
                          </span>
                        </div>
                      </div>
                
                      <div class="form-group row mb-2">
                        <label for="new_dest_addr_npi" class="col-sm-6 label">New Destination Address NPI</label>
                        <div class="col-sm-6">
                          <select class="form-select" id="new_dest_addr_npi" formControlName="new_dest_addr_npi">
                            @for (item of newDestAddrNpiList; track $index) {
                            <option value="{{ item.id }}">{{ item.description }}</option>
                            }
                          </select>
                          <span class="text-danger mt-2" *ngIf="validInput('new_dest_addr_npi')">
                            the field is required
                          </span>
                        </div>
                      </div>
                    </div>
                  </div>

                  <div class="form-group row mb-2">
                    <label for="new_short_message" class="col-sm-3 label">New Short Message</label>
                    <div class="col-sm-9">
                      <input type="text" class="form-control" id="new_short_message" formControlName="new_short_message"
                        [class.is-invalid]="validInput('new_short_message')">
                    </div>
                  </div>
                </div>
                
                <div class="col-sm-4">
                  <div class="form-group row mb-2">
                    <label for="new_gt_sccp_addr_mt" class="col-sm-6 label">New GT SCCP Address for MT</label>
                    <div class="col-sm-6">
                      <input type="text" class="form-control" id="new_gt_sccp_addr_mt" formControlName="new_gt_sccp_addr_mt"
                        [class.is-invalid]="validInput('new_gt_sccp_addr_mt')">
                      <span class="text-danger mt-2" *ngIf="validInput('new_gt_sccp_addr_mt')">
                        the field is required
                      </span>
                    </div>
                  </div>

                  <div class="form-group row mb-2">
                    <label for="drop_map_sri" class="col-sm-6 label">Drop after get MAP SRI Response</label>
                    <div class="col-sm-6">
                      <input type="checkbox" class="form-check-input check_form" id="drop_map_sri" formControlName="drop_map_sri"
                        [class.is-invalid]="validInput('drop_map_sri')">
                      <span class="text-danger mt-2" *ngIf="validInput('drop_map_sri')">
                        the field is required
                      </span>
                    </div>
                  </div>

                  <div class="form-group row mb-2">
                    <label for="network_id_to_map_sri" class="col-sm-6 label">Reroute after get MAP SRI Response</label>
                    <div class="col-sm-6">
                      <select class="form-select" id="network_id_to_map_sri" formControlName="network_id_to_map_sri">
                        <option value="">Undefined</option>
                        @for (item of networksListSs7; track $index) {
                        <option value="{{ item.network_id }}">{{ item.network_id + ' | ' +item.name }}</option>
                        }
                      </select>
                      <span class="text-danger mt-2" *ngIf="validInput('network_id_to_map_sri')">
                        the field is required
                      </span>
                    </div>
                  </div>
        
                  <div class="form-group row mb-2">
                    <label for="network_id_to_permanent_failure" class="col-sm-6 label">Reroute after get Permanent Failure</label>
                    <div class="col-sm-6">
                      <select class="form-select" id="network_id_to_permanent_failure" formControlName="network_id_to_permanent_failure">
                        <option value="">Undefined</option>
                        @for (item of networksListSs7; track $index) {
                        <option value="{{ item.network_id }}">{{ item.network_id + ' | ' +item.name }}</option>
                        }
                      </select>
                      <span class="text-danger mt-2" *ngIf="validInput('network_id_to_permanent_failure')">
                        the field is required
                      </span>
                    </div>
                  </div>
        
                  <div class="form-group row mb-2 d-none">
                    <label for="drop_temp_failure" class="col-sm-6 label">Drop Temp Failure</label>
                    <div class="col-sm-6">
                      <input type="checkbox" class="form-check-input check_form" id="drop_temp_failure" formControlName="drop_temp_failure"
                        [class.is-invalid]="validInput('drop_temp_failure')">
                      <span class="text-danger mt-2" *ngIf="validInput('drop_temp_failure')">
                        the field is required
                      </span>
                    </div>
                  </div>
        
                  <div class="form-group row mb-2">
                    <label for="network_id_temp_failure" class="col-sm-6 label">Reroute after get Temp Failure</label>
                    <div class="col-sm-6">
                      <select class="form-select" id="network_id_temp_failure" 
                        formControlName="network_id_temp_failure" (change)="onChangeState('network_id_temp_failure')">
                        <option value="">Undefined</option>
                        @for (item of networksListSs7; track $index) {
                        <option value="{{ item.network_id }}">{{ item.network_id + ' | ' +item.name }}</option>
                        }
                      </select>
                      <span class="text-danger mt-2" *ngIf="validInput('network_id_temp_failure')">
                        the field is required
                      </span>
                    </div>
                  </div>

                  <div class="form-group row mb-2">
                    <label for="check_sri_response" class="col-sm-6 label">Check SRI Response in the rules</label>
                    <div class="col-sm-6">
                      <input type="checkbox" class="form-check-input check_form" id="check_sri_response" formControlName="check_sri_response"
                        [class.is-invalid]="validInput('check_sri_response')">
                      <span class="text-danger mt-2" *ngIf="validInput('check_sri_response')">
                        the field is required
                      </span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="accordion-item">
          <h2 class="accordion-header" id="headingThree">
            <button class="accordion-button custom-accordion-header collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseThree" aria-expanded="false" aria-controls="collapseThree"
              [attr.aria-expanded]="accordionC ? 'true' : 'false'" >
              Destinations
            </button>
          </h2>
          <div id="collapseThree" class="accordion-collapse collapse" aria-labelledby="headingThree" [ngClass]="{ 'show': accordionC }">
            <div class="accordion-body mt-2">
              <div formArrayName="destination" class="">

                <div class="row">
                  <div class="col-sm-6">
                    <div class="card">
                      <form [formGroup]="formTarget" class="row mt-3 mb-2 d-flex justify-content-center">
                        <h6 class="modal-title text-center mx-auto mb-2">Destinations</h6>
        
                        <div class="form-group row mb-2">
                          <label for="priority" class="col-sm-6 label">Priority</label>
                          <div class="col-sm-6">
                            <input type="text" class="form-control" id="priority" formControlName="priority"
                              [class.is-invalid]="validInput('priority')">
                          </div>
                        </div>
        
                        <div class="form-group row mb-2">
                          <label for="network_id" class="col-sm-6 label">Destination Network</label>
                          <div class="col-sm-6">
                            <select class="form-select" id="network_id" formControlName="network_id">
                              <option value="">Select a network</option>
                              @for (item of destinationNetwoksList; track $index) {
                              <option value="{{ item.network_id }}">{{ item.network_id + ' | ' +item.name }}</option>
                              }
                            </select>
                            <span class="text-danger mt-2" *ngIf="validInput('network_id')">
                              the field is required
                            </span>
                          </div>
                        </div>
        
                        <button class="btn btn-red" 
                                style="width: 30%; float: right !important;" 
                                [disabled]="formTarget.invalid" type="button"
                                (click)="addDestination()">Add</button>
        
                      </form>
                    </div>
                  </div>
                  <div class="col-sm-6">
                    <div class="table-responsive mb-2">
                      <ul class="list-group" cdkDropList (cdkDropListDropped)="drop($event)">
                        <li class="list-group-item list-group-item-secondary d-flex justify-content-between align-items-center fw-bold">
                          <span class="me-2" style="color: #000;">Priority</span>
                          <span class="me-2" style="color: #000;">Network</span>
                          <span style="color: #000;">Actions</span>
                        </li>
                        <div>
                          <li *ngFor="let item of destinationList; let i = index" class="list-group-item d-flex justify-content-between align-items-center" cdkDrag>
                            <span class="align-middle">{{ i+1 }}</span>
                            <span class="align-middle">{{ item.gateway_name }}</span>
                            <span class="align-center">
                              <button class="btn btn-sm btn-danger me-2" type="button" title="Delete record" (click)="removeDestination(i)">
                                <i class='bx bxs-trash-alt'></i>
                              </button>
                            </span>
                          </li>
                        </div>
                      </ul>
                    </div>
                  </div>
                </div>
    
    
              </div>
            </div>
          </div>
        </div>
      </div>


        <button class="btn btn-red" style="width: 60%;" [disabled]="form.invalid" type="submit">Save</button>
    </form>
  </div>
</div>